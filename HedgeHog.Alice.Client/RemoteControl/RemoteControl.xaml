<UserControl x:Class="HedgeHog.Alice.Client.RemoteControlView"
             xmlns:tlrkInput="clr-namespace:Telerik.Windows.Controls;assembly=Telerik.Windows.Controls.Input"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d" 
>
  <UserControl.Resources>
    <DataTemplate x:Key="DeleteAccountCellTemplate">
      <Button Content="X" CommandParameter="{Binding BindsDirectlyToSource=True}" 
            Command="{Binding DataContext.DeleteTradingMacroCommand,RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
    </DataTemplate>
    <DataTemplate x:Key="InstrumentTemplate">
      <ContentPresenter Content="{Binding Pair}"/>
    </DataTemplate>
    <DataTemplate x:Key="InstrumentEditTemplate">
      <ComboBox ItemsSource="{Binding DataContext.Instruments,Mode=OneWay,RelativeSource={RelativeSource AncestorType=DataGrid}}" SelectedValue="{Binding Pair,Mode=TwoWay}"></ComboBox>
    </DataTemplate>
    <DataTemplate x:Key="TradingRatioTemplate">
      <ContentPresenter HorizontalAlignment="Center" Content="{Binding TradingRatio}"/>
    </DataTemplate>
    <DataTemplate x:Key="TradingRatioEditTemplate">
      <ComboBox ItemsSource="{Binding DataContext.TradingRatios,Mode=OneWay,RelativeSource={RelativeSource AncestorType=DataGrid}}" SelectedValue="{ Binding TradingRatio,Mode=TwoWay}"></ComboBox>
    </DataTemplate>
    <DataTemplate x:Key="BuyCellTemplate">
      <Button Content="Buy" CommandParameter="{Binding BindsDirectlyToSource=True}" 
            Command="{Binding DataContext.BuyCommand,RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
    </DataTemplate>
    <DataTemplate x:Key="SellCellTemplate">
      <Button Content="Sell" CommandParameter="{Binding BindsDirectlyToSource=True}" 
            Command="{Binding DataContext.SellCommand,RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
    </DataTemplate>

    <DataTemplate x:Key="NumberOfLotsCellTemplate">
      <ContentPresenter Content="{Binding Lots}" HorizontalAlignment="Center" />
    </DataTemplate>
    <DataTemplate x:Key="NumberOfLotsCellEditTemplate">
      <tlrkInput:RadNumericUpDown Value="{Binding Lots,Mode=TwoWay}" />
    </DataTemplate>

    <DataTemplate x:Key="StopCellTemplate">
      <ContentPresenter HorizontalAlignment="Center" Content="{Binding Stop}"/>
    </DataTemplate>
    <DataTemplate x:Key="StopCellEditTemplate">
      <tlrkInput:RadNumericUpDown Value="{Binding Stop,Mode=TwoWay}" />
    </DataTemplate>
    <DataTemplate x:Key="LimitBarCellTemplate">
      <ContentPresenter HorizontalAlignment="Center" Content="{Binding LimitBar}"/>
    </DataTemplate>
    <DataTemplate x:Key="LimitBarCellEditTemplate">
      <ComboBox SelectedValue="{Binding LimitBar}">
        <sys:Int32>1</sys:Int32>
        <sys:Int32>2</sys:Int32>
        <sys:Int32>3</sys:Int32>
        <sys:Int32>4</sys:Int32>
        <sys:Int32>5</sys:Int32>
        <sys:Int32>6</sys:Int32>
        <sys:Int32>7</sys:Int32>
        <sys:Int32>8</sys:Int32>
        <sys:Int32>9</sys:Int32>
        <sys:Int32>10</sys:Int32>
        <sys:Int32>11</sys:Int32>
        <sys:Int32>12</sys:Int32>
        <sys:Int32>13</sys:Int32>
        <sys:Int32>14</sys:Int32>
        <sys:Int32>15</sys:Int32>
        <sys:Int32>16</sys:Int32>
        <sys:Int32>17</sys:Int32>
        <sys:Int32>18</sys:Int32>
        <sys:Int32>19</sys:Int32>
        <sys:Int32>20</sys:Int32>
      </ComboBox>
    </DataTemplate>
    <DataTemplate x:Key="TradeAmountCellTemplate">
      <ContentPresenter HorizontalAlignment="Right" Content="{Binding TradeAmount}" ContentStringFormat="c0" />
    </DataTemplate>

    <DataTemplate x:Key="NetCellTemplate">
      <Label HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Background="{Binding Net,Converter={StaticResource DoubleToColorConverter},ConverterParameter=Transparent|LightSalmon|LightGreen}">
        <WrapPanel>
          <TextBlock Text="{Binding Net,StringFormat=c1}"/>
          <TextBlock Text="{Binding CurrentLot,StringFormat=/{0:n0}}"/>
        </WrapPanel>
      </Label>
    </DataTemplate>
    <DataTemplate x:Key="LossCellTemplate">
      <Label Content="{Binding CurrentLoss}" ContentStringFormat="c0" HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Background="{Binding CurrentLoss,Converter={StaticResource DoubleToColorConverter},ConverterParameter=Transparent|LightSalmon|LightGreen}" />
    </DataTemplate>
    <DataTemplate x:Key="CloseCellTemplate">
      <Button Content="Close" CommandParameter="{Binding BindsDirectlyToSource=True}" 
            Command="{Binding DataContext.ClosePairCommand,RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
    </DataTemplate>
    <DataTemplate x:Key="ReverseCellTemplate">
      <Button Content="Reverse" CommandParameter="{Binding BindsDirectlyToSource=True}" 
            Command="{Binding DataContext.ReversePairCommand,RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
    </DataTemplate>
    <DataTemplate x:Key="OverlapCellTemplate">
      <Label HorizontalAlignment="Stretch" HorizontalContentAlignment="Right" Background="{Binding AngleInRadians,Converter={StaticResource DoubleToColorConverter},ConverterParameter=Transparent|LightSalmon|LightGreen}" />
    </DataTemplate>
  </UserControl.Resources>
    <Grid>
    <DataGrid ItemsSource="{Binding TradingMacros}" AutoGenerateColumns="False" EnableRowVirtualization="False" KeyDown="DataGrid_KeyDown">
      <DataGrid.Columns>
        <DataGridTemplateColumn CellTemplate="{StaticResource DeleteAccountCellTemplate}"/>
        <DataGridTemplateColumn Header="Pair" CellTemplate="{StaticResource InstrumentTemplate}" CellEditingTemplate="{StaticResource InstrumentEditTemplate}"/>
        <DataGridTemplateColumn Header="Ratio" CellTemplate="{StaticResource TradingRatioTemplate}" CellEditingTemplate="{StaticResource TradingRatioEditTemplate}"/>
        <DataGridTextColumn Header="$/Lot" Binding="{Binding LotSize,Mode=OneWay}" IsReadOnly="True" />
        <DataGridTemplateColumn Header="#Lots" CellTemplate="{StaticResource NumberOfLotsCellTemplate}" CellEditingTemplate="{StaticResource NumberOfLotsCellEditTemplate}" />
        <DataGridTemplateColumn Header="$Lot" CellTemplate="{StaticResource TradeAmountCellTemplate}" IsReadOnly="True" />
        <DataGridTextColumn Header="Stop" Binding="{Binding Stop}" IsReadOnly="True" />
        <DataGridTextColumn Header="|L|" Binding="{Binding LimitBar}" />
        <DataGridTextColumn Header="L=" Binding="{Binding Limit}" IsReadOnly="True"/>
        <DataGridTemplateColumn CellTemplate="{StaticResource BuyCellTemplate}"></DataGridTemplateColumn>
        <DataGridTemplateColumn Header="Loss" CellTemplate="{StaticResource LossCellTemplate}" />
        <DataGridTemplateColumn Header="Net" CellTemplate="{StaticResource NetCellTemplate}" />
        <DataGridTextColumn Header="L ∑" Binding="{Binding LimitAmount,StringFormat=c1}" IsReadOnly="True"/>
        <DataGridTemplateColumn CellTemplate="{StaticResource SellCellTemplate}"></DataGridTemplateColumn>
        <DataGridCheckBoxColumn Header="FL" Binding="{Binding FreezLimit}" />
        <DataGridCheckBoxColumn Header="FS" Binding="{Binding FreezStop}" />
        <DataGridCheckBoxColumn Header="ROP" Binding="{Binding IsReverseOnProfit}" ToolTipService.ToolTip="Reverse on profit" />
        <DataGridTemplateColumn CellTemplate="{StaticResource CloseCellTemplate}"></DataGridTemplateColumn>
        <DataGridTemplateColumn CellTemplate="{StaticResource ReverseCellTemplate}"></DataGridTemplateColumn>

        <!--<DataGridTextColumn Header="LB" Binding="{Binding BalanceOnLimit,StringFormat=c0}" IsReadOnly="True"/>
        <DataGridTextColumn Header="S ∑" Binding="{Binding StopAmount,StringFormat=c1}" IsReadOnly="True"/>
        <DataGridTextColumn Header="SB" Binding="{Binding BalanceOnStop,StringFormat=c0}" IsReadOnly="True"/>-->

        <DataGridTemplateColumn Header="Ŧ" IsReadOnly="True">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <WrapPanel>
                <TextBlock Text="{Binding Corridornes,StringFormat=p0}" />
                <TextBlock Text="{Binding CorridorMinutes,StringFormat=/{0:n0}}" />
              </WrapPanel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
        <DataGridTemplateColumn Header="OL"  IsReadOnly="True">
          <DataGridTemplateColumn.CellTemplate>
            <DataTemplate>
              <WrapPanel>
                <TextBlock Text="{Binding Overlap}"/>
                <TextBlock Text="{Binding Overlap5,StringFormat=/{0:n0}}"/>
              </WrapPanel>
            </DataTemplate>
          </DataGridTemplateColumn.CellTemplate>
        </DataGridTemplateColumn>
        <!--<DataGridTextColumn Header="OL#" Binding="{Binding OverlapToStop}" />
        <DataGridTemplateColumn Header="&lt;&gt;" IsReadOnly="True" CellTemplate="{StaticResource OverlapCellTemplate}"/>-->
        <DataGridTextColumn Header="RateTime" Binding="{Binding LastRateTime,StringFormat=HH:mm}" IsReadOnly="True"/>
      </DataGrid.Columns>
    </DataGrid>

  </Grid>
</UserControl>
