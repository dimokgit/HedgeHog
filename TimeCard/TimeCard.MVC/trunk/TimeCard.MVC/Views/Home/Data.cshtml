@{
    ViewBag.Title = "Data";
}
<![if false]>
<script src="../../Scripts/jquery.js" type="text/javascript"></script>
<script src="../../Scripts/jquery-ui-1.8.11.js" type="text/javascript"></script>
<script src="../../Scripts/jquery-ui-timepicker-addon.js" type="text/javascript"></script>
<script src="../../Scripts/date.js" type="text/javascript"></script>
<script src="../../Scripts/Namespace.js" type="text/javascript"></script>
<script src="../../Scripts/knockout.js" type="text/javascript"></script>
<script src="../../Scripts/knockout.data.js" type="text/javascript"></script>
<script src="../../Scripts/knockout.extentions.js" type="text/javascript"></script>
<![endif]>
<style>
  DIV.dataContainer TABLE
  {
  	display:inline-table;
  }
  TFOOT TR TD DIV
  {
  	overflow:inherit;
  	width;100%;
  }
  TFOOT TR TD input
  {
  	float:left;
  	width:100%;
  	white-space:pre;
  	overflow-x:visible;
  }
td input {
    width: 100%;
    box-sizing: border-box;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
}
</style>
<h2>Data</h2>
<div class="dataContainer"></div>
<script>
  jQuery.extend({
    propsToArray: function (o) {
      return jQuery.map(o, function (v, n) { return n; });
    }
  });
  jQuery.extend({
    Linq: {
      select: function (array, prop) {
        return jQuery.map(array, function (v, n) { return v[prop]; });
      }
    }
  });
  $(function () {
    var vm = {
      crud: ["punchTypes", "punchDirections", "punches"],
      format: function (v) {
        if (typeof v == "string" && v.indexOf("/Date(") == 0)
          return eval("new " + v.slice(1, -1)).toString("MM/dd/yyyy HH:mm");
        return v;
      },
      homePath: "/home/"
    };
    $.extend(vm, ko.data.MvcCrud);
    vm.initCrud();
    vm.GetData(vm, "punchTypes", "#punchTypesTemplate");
    vm.GetData(vm, "punchDirections", "#punchDirectionsTemplate");
    vm.GetData(vm, "punches", "#punchesTemplate");
  });
</script>
<table id="punchTypesTemplate" style="display:inline-table">
<thead>
  <tr data-bind="foreach:{{columns}},attr:{'data-bind':''}">
    <th data-bind="text:$data,attr:{'data-bind':''}"></th>
  </tr>
  <tr><th>X</th></tr>
</thead>
<tbody data-bind="attr:{'data-bind':'foreach:{{rows}}'}">
<tr data-bind="foreach: {{columns}},attr:{'data-bind':''}">
<td data-bind='attr:{"data-bind": "text: $root.format($data[\""+$data+"\"])"}' align='right'/>
</tr>
<tr><td><input type="button" value="X" data-bind='attr:{"data-bind":"click:$.proxy($root.{{delete}},$root)"}' /></td></tr>
</tbody>
<tfoot>
  <tr data-bind="foreach:{{columns}},attr:{'data-bind':''}">
    <td>
      <input data-bind='attr:{"data-bind":"value: $root.{{new}}[\""+$data+"\"]"}' size="1" />
    </td>
  </tr>
  <tr>
    <td>
      <span>
        <input type="button" value="Add" data-bind='attr:{"data-bind":"click:$root.{{add}}"}' />
      </span>
     </td>
  </tr>
</tfoot>
</table>
<table id="punchDirectionsTemplate" style="display:inline-table">
<thead>
  <tr data-bind="foreach:{{columns}},attr:{'data-bind':''}">
    <th data-bind="text:$data,attr:{'data-bind':''}"></th>
  </tr>
  <tr><th>X</th></tr>
</thead>
<tbody data-bind="attr:{'data-bind':'foreach:{{rows}}'}">
<tr data-bind="foreach: {{columns}},attr:{'data-bind':''}">
<td data-bind='attr:{"data-bind": "text: $root.format($data[\""+$data+"\"])"}' align='right'/>
</tr>
<tr><td><input type="button" value="X"  data-bind='attr:{"data-bind":"click:$.proxy($root.{{delete}},$root)"}' /></td></tr>
</tbody>
<tfoot>
  <tr data-bind="foreach:{{columns}},attr:{'data-bind':''}">
    <td>
      <input data-bind='attr:{"data-bind":"value: $root.{{new}}[\""+$data+"\"]"}' size="1" />
    </td>
  </tr>
  <tr>
    <td>
      <span>
        <input type="button" value="Add" data-bind="click:$root.{{add}}" />
      </span>
     </td>
  </tr>
</tfoot>
</table>
<table id="punchesTemplate">
<caption>Punches</caption>
<thead>
  <tr data-bind="foreach:{{columns}},attr:{'data-bind':''}">
    <th data-bind="text:$data,attr:{'data-bind':''}"></th>
  </tr>
  <tr><th>X</th></tr>
</thead>
<tbody data-bind="attr:{'data-bind':'foreach:{{rows}}'}">
<tr data-bind="foreach: {{columns}},attr:{'data-bind':''}">
<td data-bind='attr:{"data-bind": "text: $root.format($data[\""+$data+"\"])"}' align='right'/>
</tr>
<tr><td><input type="button" value="X"  data-bind='attr:{"data-bind":"click:$.proxy($root.{{delete}},$root)"}' /></td></tr>
</tbody>
<tfoot>
  <tr>
  <td>
<input data-bind="datetimepicker: punchesNew.Time, 
           datetimepickerOptions: {}" size="1" />
  </td>
  <td><select data-bind="options:punchDirections,optionsText:'Name',value:punchesNew.Direction" /></td>
  <td><select data-bind="options:punchTypes,optionsText:'Name',value:punchesNew.Type" /></td>
    <td>
      <span>
        <input type="button" value="Add" data-bind="click:$root.{{add}}" />
      </span>
     </td>
  </tr>
</tfoot>
</table>
